# Pocket Change's Android SDK Plugin for Unity.

Follow the instructions below to integrate the SDK plugin.

Prerequisites:

- <a href="http://www.eclipse.org/downloads/">Android SDK</a> (version 17 or later)
- Unity (version 3.4 or later)

**Note that version 17 of the Android SDK was released in 03/2012; if you experience build errors, please ensure that you have an appropriate version.**

## Step 1: Obtain an id for your game

In order to integrate the Pocket Change Android SDK plugin, you must first obtain an APP\_ID from your account manager. Each game will have a separate APP\_ID.

## Step 2: Download the Plugin

Download the plugin from <https://github.com/pocketchange/pocketchange-android-sdk-unity-plugin/blob/master/PocketChangeAndroid.unitypackage?raw=true>.

## Step 3: Import the Plugin in Unity

To use the plugin, you must import its corresponding package in Unity: From within your Unity project, select Assets » Import Package » Custom Package and pick the location of the package you downloaded in step 2.

<img src="https://dl.dropbox.com/u/68268326/unity-plugin-doc-images/import_package.png" alt="Import Package" width="476" height="384" />

## Step 4: Create an AndroidManifest.xml

If your project does not already contain an AndroidManifest.xml file in its Plugins/Android directory, you will need to create one.

For your convenience, the Pocket Change plugin includes sample manifest files for Unity 3.4 (Unity34AndroidManifest.xml) and Unity 3.5 (Unity35AndroidManifest.xml); you can find these sample files in Plugins/PocketChangeAndroid/manifest.

Each sample manifest replaces the default manifest generated by the corresponding version of Unity, as Unity cannot auto-generate appropriate manifests for applications with plugins. You must still configure and update the sample manifests:

* Change the package attribute of the &lt;manifest&gt; element to a unique identifier for your game.
* Add the Pocket Change plugin components by following the instructions in step 5.

For additional information on Android manifest files, see <http://developer.android.com/guide/topics/manifest/manifest-intro.html>.

## Step 5: Modify your AndroidManifest.xml

Update your Plugins/Android/AndroidManifest.xml file to declare the components and permissions required by the SDK plugin. 

If your manifest file does not already include the permissions to connect to the internet, access network state, obtain account information, and read telephony state, add them inside the <manifest> block. We only use account information for simplifying the login and purchasing flows. We only use telephone state in cases where the phone does not have a valid device ID.

    <uses-permission android:name="android.permission.GET_ACCOUNTS"></uses-permission>
    <uses-permission android:name="android.permission.INTERNET"></uses-permission>
    <uses-permission android:name="android.permission.READ_PHONE_STATE"></uses-permission>
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"></uses-permission>
Finally, declare the application components the SDK requires inside of the <application> block. For applications targeting SDK versions 14 and higher (by setting minSdkVersion or targetSdkVersion >= 14 in the uses-sdk element):

    <activity
        android:name="com.pocketchange.android.rewards.DisplayRewardActivity"
        android:theme="@android:style/Theme.Translucent.NoTitleBar.Fullscreen"
        android:hardwareAccelerated="false">
    </activity>
    <activity
        android:name="com.pocketchange.android.rewards.ShopActivity"
        android:theme="@android:style/Theme.Translucent.NoTitleBar.Fullscreen"
        android:hardwareAccelerated="false">
    </activity>

    <service android:name="com.pocketchange.android.http.AsyncHttpRequestService" />
When targeting these newer SDK version, you may also need to set your project's target (the target property in project.properties) to android-11 or higher, or the build tools will not recognize the android:hardwareAccelerated attribute.

For applications not matching the aforementioned criterion:

    <activity
        android:name="com.pocketchange.android.rewards.DisplayRewardActivity"
        android:theme="@android:style/Theme.Translucent.NoTitleBar.Fullscreen">
    </activity>
    <activity
        android:name="com.pocketchange.android.rewards.ShopActivity"
        android:theme="@android:style/Theme.Translucent.NoTitleBar.Fullscreen">
    </activity>

    <service android:name="com.pocketchange.android.http.AsyncHttpRequestService" />
Only use one of the provided component declarations. If you're unsure which SDK version your application targets, try the manifest entries in the order listed; if the first set of entries causes build errors due to unrecognized XML elements, use the second set.

## Step 6: Integrate the plugin with your game

To initialize the plugin, add the PocketChangeAndroidPlayerInitializer prefab to the first scene in your game; this object persists for the lifetime of your game and automatically invokes SDK lifecycle components as needed.

To configure the plugin, change the APP\_ID constant in the PocketChangeAndroidConfig script to match the APP\_ID you obtained in step 1.

Visual notifications may accompany certain rewards. In order to avoid interfering with your application, the plugin queues these notifications so that you can deliver them at convenient times. Your application must periodically display these notifications, or users will be unaware of their rewards.

To display the next pending notification, call:
```C#
PocketChangeAndroid.DisplayReward();
```

Only invoke the `DisplayReward` method after the player has initialized all script instances by calling their `Awake` methods (typically, you should not need any additional logic to enforce this requirement).

### Add a Button to Open the Pocket Change Shop (Optional)

We encourage developers to add a Pocket Change button which opens our shop. Please use the assets <a href="https://www.dropbox.com/s/aivv76wo7kk4j34/pocket_change_tokens.png">here</a>. When the user clicks the button, call:

```C#
PocketChangeAndroid.OpenShop();
```

## <a name="testing"></a>Testing

You can use test mode to validate your integration: The plugin will grant unlimited rewards so that you can confirm your application's behavior after a reward has been granted. To enable test mode:

* In PocketChangeAndroidConfig, set the ENABLE\_TEST\_MODE constant to true.
* When building your application, check the "Development Build" box in your Android build settings (File � Build Settings � Android).

**You must disable test mode before releasing your app, otherwise users will not receive real rewards.**

The plugin only works properly on real devices. Do not use emulators for testing or you may get faulty test results.

## <a name="multi-platform-support"></a>Supporting Multiple Platforms

The Pocket Change plugin currently only supports the Android platform. If your Unity project targets multiple platforms, you must ensure that your application does not invoke any PocketChangeAndroid class methods on non-Android platforms, as such invocations will result in runtime errors. To avoid calling Android methods on non-Android platforms, use conditional compilation directives:

```C#
#if UNITY_ANDROID
PocketChangeAndroid.Method();
#endif
```

## <a name="upgrading"></a>Upgrading

To upgrade from an earlier release of the plugin:

1. Delete all files from the earlier plugin release.
2. Delete all of the previous plugin entries from your AndroidManifest.xml.
3. Complete steps 3, 5, and 6.

